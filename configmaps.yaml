# ConfigMaps for the Ticker Pipeline
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ticker-ui-code
data:
  index.html: |
    <!DOCTYPE html>
    <html>
    <body style="background:#000; color:#0f0; font-family:monospace; text-align:center; padding-top:50px;">
        <h1>ðŸš€ LIVE K8S TICKER</h1>
        <div id="price" style="font-size:7em;">0.00</div>
        <div id="status" style="color:#444;">Connecting...</div>
        <div id="debug" style="margin-top:50px; color:red; font-size:0.8em;"></div>
        <script type="module">
            import { connect, StringCodec } from "https://cdn.jsdelivr.net/npm/nats.ws@latest/esm/nats.js";
            const log = (m) => { document.getElementById('debug').innerText += m + '\n'; };
            async function start() {
                try {
                    log("Attempting connection to ws://127.0.0.1:30080...");
                    const nc = await connect({ servers: "ws://127.0.0.1:30080" });
                    document.getElementById('status').innerText = 'CONNECTED';
                    document.getElementById('status').style.color = '#0f0';
                    log("SUCCESS: Linked to NATS!");

                    const sub = nc.subscribe("market.ticks");
                    const sc = StringCodec();
                    for await (const m of sub) {
                        document.getElementById('price').innerText = sc.decode(m.data);
                    }
                } catch (err) {
                    log("NATS ERROR: " + (err.message || err.code || JSON.stringify(err)));
                    document.getElementById('status').innerText = 'RECONNECTING...';
                    setTimeout(start, 3000);
                }
            }
            start();
        </script>
    </body>
    </html>
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nats-config
data:
  nats.conf: |
    port: 4222
    websocket {
      port: 8080
      no_tls: true
      same_origin: false
    }
